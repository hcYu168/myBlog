<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Single Post</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <script type="text/javascript" src= "/public/jquery-1.11.3.min.js"></script>
    <!-- Bootstrap styles -->
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">

    <!-- Font-Awesome -->
    <link rel="stylesheet" href="/public/css/font-awesome/css/font-awesome.min.css">
    
    <!-- Google Webfonts -->
   <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600|PT+Serif:400,400italic' rel='stylesheet' type='text/css'> -->

    <!-- Styles -->
    <link rel="stylesheet" href="/public/css/style.css" id="theme-styles">
    <!--[if lt IE 9]>      
        <script src="js/vendor/google/html5-3.6-respond-1.1.0.min.js"></script>
    <![endif]-->
    
</head>
<body>
    <header>
        <div class="widewrapper masthead">
            <div class="container">
                <a href="/public/index.html" id="logo">
                    <img src="/public/img/logo.png" alt="clean Blog">
                </a>

                <div id="mobile-nav-toggle" class="pull-right">
                    <a href="#" data-toggle="collapse" data-target=".clean-nav .navbar-collapse">
                        <i class="fa fa-bars"></i>
                    </a>
                </div>

                <nav class="pull-right clean-nav">
                    <div class="collapse navbar-collapse">
                        <ul class="nav nav-pills navbar-nav">
                          
                             <li>
                                <a href="/blog/index">首页</a>
                            </li>
                            <li>
                                <a href="/blog/article/page/list">文章</a>
                            </li>
                            <li>
                                <a href="about.html">关于我</a>
                            </li>
                            <li>
                                <a href="contact.html">留言</a>
                            </li>                                          
                        </ul>
                    </div>
                </nav>        

            </div>
        </div>

        <div class="widewrapper subheader">
            <div class="container">
                <div class="clean-breadcrumb">
                    <a href="#">Blog</a>
                    <span class="separator">&#x2F;</span>
                    <a href="#">Bootstrap</a>
                    <span class="separator">&#x2F;</span>
                    <a href="#">HTML Template</a>
                </div>

              
                <div class="clean-searchbox">
                    <form action="#" method="get" accept-charset="utf-8">
                       
                        <input class="searchfield" id="searchbox" type="text" placeholder="Search">
                         <button class="searchbutton" type="submit">
                            <i class="fa fa-search"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </header>

    <div class="widewrapper main">
        <div class="container">
            <div class="row">
                <div class="col-md-8 blog-main">
                    <article class="blog-post">
                        <header>
                           
                            <div class="lead-image">
                                <img src="/public/img/single-post.jpg" alt="" class="img-responsive">
                                
                            </div>
                        </header>
                        <div class="body">
                            <h1><%= article.title%></h1>
                            <div class="meta">
                                <i class="fa fa-user"></i> <%= article.auth%> <i class="fa fa-calendar"></i><%= article.createTime%><i class="fa fa-comments"></i><span class="data"><a href="#comments"><%= article.commentSum%> Comments</a></span>
                            </div>
                            <%- article.content%>
                        </div>
                    </article>

                    <aside class="social-icons clearfix">
                        <h3>Share on </h3> 
                        <!-- <a href="#"><i class="fa fa-facebook"></i></a>
                        <a href="#"><i class="fa fa-twitter"></i></a> 
                        <a href="#"><i class="fa fa-google"></i></a> -->
                        <!-- JiaThis Button BEGIN -->
                        <div class="jiathis_style_24x24">
                            <a class="jiathis_button_qzone"></a>
                            <a class="jiathis_button_tsina"></a>
                            <a class="jiathis_button_tqq"></a>
                            <a class="jiathis_button_weixin"></a>
                            <a class="jiathis_button_renren"></a>
                            <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
                            <a class="jiathis_counter_style"></a>
                        </div>
                        <script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
                        <!-- JiaThis Button END --> 
                    </aside>

                    <aside class="comments" id="comments">
                        <hr>
                       <!--  <h2><i class="fa fa-comments"></i> 6 Comments</h2> -->
                        <%for(var i=0; i< comments.length; i++){%>
                            <article class="comment">
                                <header class="clearfix">
                                    <img src="<%=comments[i][0].userImg %>" alt="A Smart Guy" class="avatar">
                                    <div class="meta">
                                        <h3><a href="#"><%=comments[i][0].userName %></a></h3>
                                        <span class="date">
                                            <%=comments[i][0].createTime %>
                                        </span>
                                        <span class="separator">
                                            -
                                        </span>
                                        
                                        <button class="reply-link" onclick="rep(<%=comments[i][0].id %>, <%=comments[i][0].userId %>,<%=comments[i][0].comment_state %>)">回复</button>            
                                    </div>
                                </header>
                                <div class="body">
                                   <%=comments[i][0].content %>
                                </div>
                            </article>
                            <%for(var j=1; j< comments[i].length; j++){%>
                                <article class="comment reply">
                                    <header class="clearfix">
                                        <img src="<%=comments[i][j].userImg %>" alt="A Smart Guy" class="avatar">
                                        <div class="meta">
                                            <h3><a href="#"><%=comments[i][j].userName %></a></h3>
                                            <span class="date">
                                                <%=comments[i][j].createTime %>
                                            </span>
                                            <span class="separator">
                                                -
                                            </span>
                                            
                                            <button class="reply-link" onclick="rep(<%=comments[i][j].id %>, <%=comments[i][j].userId %>,<%=comments[i][j].comment_state %>)">回复</button>                
                                        </div>
                                    </header>
                                    <% if(comments[i][j].rep_userId == comments[i][0].userId){ %>
                                        <div class="body">
                                            <%=comments[i][j].content %>
                                        </div>
                                    <% }else if(comments[i][j].rep_userId != comments[i][0].userId){ %>
                                        <div class="body">
                                            @<%= comments[i][j].repUser %>: <%=comments[i][j].content %>
                                        </div>
                                    <% } %>
                                </article>
                            <% }%>
                        <% }%>
                    </aside>

                    <aside class="create-comment" id="create-comment">
                        <hr>    
                        <h2><i class="fa fa-pencil"></i> Add Comment</h2>

                        <form> <!-- action="#" method="get"   accept-charset="utf-8" -->
                            <div class="row">
                            <textarea rows="10" name="message" id="commentBody" placeholder="Your Message" class="form-control input-lg"></textarea>

                            <div class="buttons clearfix">
                                <input type="button" id="subButton" class="btn btn-xlarge btn-clean-one" value="submit" />
                            </div>
                        </form>
                    </aside>
                </div>
                <aside class="col-md-4 blog-aside">
                    
                    <div class="aside-widget">
                        <header>
                            <h3>Featured Post</h3>
                        </header>
                        <div class="body">
                            <ul class="clean-list">
                                <li><a href="">Clean - Responsive HTML5 Template</a></li>
                                <li><a href="">Responsive Pricing Table</a></li>
                                <li><a href="">Yellow HTML5 Template</a></li>
                                <li><a href="">Blackor Responsive Theme</a></li>
                                <li><a href="">Portfolio Bootstrap Template</a></li>
                                <li><a href="">Clean Slider Template</a></li>
                            </ul>
                        </div>
                    </div>
                
                    <div class="aside-widget">
                        <header>
                            <h3>Related Post</h3>
                        </header>
                        <div class="body">
                            <ul class="clean-list">
                                <li><a href="">Blackor Responsive Theme</a></li>
                                <li><a href="">Portfolio Bootstrap Template</a></li>
                                <li><a href="">Clean Slider Template</a></li>
                                <li><a href="">Clean - Responsive HTML5 Template</a></li>
                                <li><a href="">Responsive Pricing Table</a></li>
                                <li><a href="">Yellow HTML5 Template</a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="aside-widget">
                        <header>
                            <h3>Tags</h3>
                        </header>
                        <div class="body clearfix">
                            <ul class="tags">
                                <li><a href="#">HTML5</a></li>
                                <li><a href="#">CSS3</a></li>
                                <li><a href="#">COMPONENTS</a></li>
                                <li><a href="#">TEMPLATE</a></li>
                                <li><a href="#">PLUGIN</a></li>
                                <li><a href="#">BOOTSTRAP</a></li>
                                <li><a href="#">TUTORIAL</a></li>
                                <li><a href="#">UI/UX</a></li>                            
                            </ul>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>

    <footer>
        <div class="widewrapper footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 footer-widget">
                        <h3> <i class="fa fa-user"></i>About</h3>

                       <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab animi laboriosam nostrum consequatur fugiat at, labore praesentium modi, quasi dolorum debitis reiciendis facilis, dolor saepe sint nemo, earum molestias quas.</p>
                       <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dolorum, error aspernatur assumenda quae eveniet.</p>
                    </div>

                    <div class="col-md-4 footer-widget">
                        <h3> <i class="fa fa-pencil"></i> Recent Post</h3>
                        <ul class="clean-list">
                            <li><a href="">Clean - Responsive HTML5 Template</a></li>
                            <li><a href="">Responsive Pricing Table</a></li>
                            <li><a href="">Yellow HTML5 Template</a></li>
                            <li><a href="">Blackor Responsive Theme</a></li>
                            <li><a href="">Portfolio Bootstrap Template</a></li>
                            <li><a href="">Clean Slider Template</a></li>
                        </ul>
                    </div>

                    <div class="col-md-4 footer-widget">
                        <h3> <i class="fa fa-envelope"></i>Contact Me</h3>

                        <p>Lorem ipsum dolor sit amet Lorem ipsum dolor sit amet.</p>
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nihil fugiat, cupiditate veritatis excepturi tempore explicabo.</p>
                         <div class="footer-widget-icon">
                            <i class="fa fa-facebook"></i><i class="fa fa-twitter"></i><i class="fa fa-google"></i>
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>
        <div class="widewrapper copyright">
                Copyright 2015
        </div>
    </footer>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">                 
                    <div class="form-group">
                        <label >回复：</label>
                        <textarea class="form-control" id="repContent"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>
                    <button type="button" id="btn_submit" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>提交</button>
                </div>
            </div>
        </div>
    </div>
    <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>-->
    <script src="/public/js/bootstrap.min.js"></script>
    <script src="/public/js/modernizr.js"></script>

    <script type="text/javascript">
        $(document).ready(function(){
            $("#subButton").click(function(){
                const id = "<%= id%>";
                const userName = "<%= name%>"
                if(id == null || id == ""){
                    window.location.href = "/blog/login"
                }else{
                    //const userId = $("#commentId").val();
                    const content = $("#commentBody").val();
                    const originalId = "<%= article.id%>";
                    $.post("/blog/article",{
                        "userId" : id,
                        "userName": userName,
                        "content": content,
                        "originalId": originalId
                    }, function(res, err){
                        if(res.info =="ok"){
                            window.location.href= "/blog/article/<%= article.id%>"
                        }
                        if(err){
                            console.log(err);
                        }
                    })
                }
            });
        });
        function rep(id, rep_userId, comment_state){
            $("#myModal").modal();
            $("#btn_submit").click(function(){
                const userId = "<%= id%>";
                const originalId = "<%= article.id%>";
                const userName = "<%= name%>";
                if(userId == null || userId == ""){
                    window.location.href = "/blog/login"
                }else{
                    if(comment_state == 0){
                        comment_state = id
                    }
                    const content = $("#repContent").val();
                    $.post("/blog/article/createReply", {
                        "userId": userId,//由session知道userId
                        "rep_userId": rep_userId,
                        "userName": userName,
                        "content": content,
                        "originalId": originalId,
                        "comment_state": comment_state,
                    }, function(data){
                        if(data.info == "ok"){
                            window.location.href="/blog/article/"+data.originalId;
                        }
                    })
                }
            });
        }
    </script>

</body>
</html>
<!-- 这样创建完之后 session id还是用userid name就用authorization表中的name -->